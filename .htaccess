# Habilitar el motor de reescritura
RewriteEngine On

# Establecer la base para las reglas de reescritura
RewriteBase /Web-Explorer/

# Redirección de HTTP a HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirigir todas las solicitudes de archivos PDF directamente a viewer.php
# Esto captura rutas como /Web-Explorer/carpeta/archivo.pdf
RewriteCond %{REQUEST_URI} \.pdf$ [NC]
RewriteCond %{REQUEST_URI} !^/Web-Explorer/viewer\.php [NC]
RewriteCond %{REQUEST_URI} !^/Web-Explorer/src/get-pdf\.php [NC]
RewriteCond %{REQUEST_URI} !^/Web-Explorer/includes/pdfjs/ [NC]
RewriteRule ^(.+)\.pdf$ viewer.php?file=$1.pdf [QSA,L]

# Configuración de seguridad adicional
<IfModule mod_headers.c>
    # Prevenir que el navegador detecte el tipo MIME
    Header set X-Content-Type-Options "nosniff"
    
    # Protección XSS
    Header set X-XSS-Protection "1; mode=block"
    
    # Prevenir que el sitio sea embebido en iframes (clickjacking)
    Header set X-Frame-Options "SAMEORIGIN"
    
    # Política de seguridad de contenido
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com; img-src 'self' data:;"
</IfModule>

# Deshabilitar listado de directorios
Options -Indexes

# Proteger archivos sensibles
<FilesMatch "^(\.htaccess|\.htpasswd|\.git|\.env|\.gitignore|composer\.json|composer\.lock)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Prevenir acceso a archivos de respaldo y temporales
<FilesMatch "(\.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist)|~)$">
    Order Allow,Deny
    Deny from all
    Satisfy All
</FilesMatch>

