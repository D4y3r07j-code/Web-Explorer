# Configuración de seguridad para Apache
# Proyecto Web Explorer

# Denegar acceso a directorios privados
<Directory "/var/www/html/Proyecto-Web-Explorer/admin">
    # Solo permitir acceso desde localhost o IPs específicas
    Require ip 127.0.0.1
    Require ip ::1
    # Agregar IPs adicionales según sea necesario
    # Require ip 192.168.1.100
</Directory>

<Directory "/var/www/html/Proyecto-Web-Explorer/logs">
    Require all denied
</Directory>

<Directory "/var/www/html/Proyecto-Web-Explorer/src">
    Require all denied
</Directory>

<Directory "/var/www/html/Proyecto-Web-Explorer/config">
    Require all denied
</Directory>

# Proteger archivos sensibles
<Files "*.log">
    Require all denied
</Files>

<Files "*.txt">
    <RequireAll>
        Require all denied
        # Permitir solo desde el sistema
        Require ip 127.0.0.1
    </RequireAll>
</Files>

# Configuración de tipos MIME
AddType application/pdf .pdf

# Configuración de seguridad general
ServerTokens Prod
ServerSignature Off

# Headers de seguridad
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'"

# Configuración de cache
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 week"
</IfModule>

# Redirección del directorio raíz al público
RewriteEngine On
RewriteCond %{REQUEST_URI} ^/Proyecto-Web-Explorer/?$
RewriteRule ^(.*)$ /Proyecto-Web-Explorer/public/ [R=301,L]

# Reescritura para el directorio público
RewriteCond %{REQUEST_URI} !^/Proyecto-Web-Explorer/public/
RewriteCond %{REQUEST_URI} !^/Proyecto-Web-Explorer/admin/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /Proyecto-Web-Explorer/public/$1 [L]
